# REQ-000-06: 共通 非機能要件

## 概要

harborixおよび各アプリ（coinship、libship、fanship）に共通する非機能要件を定義する。

## 性能要件

### 応答時間

| 操作 | 目標応答時間 |
| ---- | ------------ |
| ページ表示（初回） | 3秒以内 |
| ページ表示（2回目以降） | 1秒以内 |
| API応答（参照系） | 500ms以内 |
| API応答（更新系） | 1秒以内 |
| 検索処理 | 2秒以内 |

### 同時接続数

| 項目 | 値 |
| ---- | -- |
| 想定同時接続数 | 10ユーザー |
| 最大同時接続数 | 50ユーザー |

※ 個人利用を想定。将来的な拡張時は見直す。

### データ容量

| 項目 | 上限 |
| ---- | ---- |
| 1ユーザーあたりのデータ量 | 1GB |
| 画像ファイルサイズ | 5MB/枚 |
| 総ストレージ | 10GB |

## 可用性要件

### 稼働率

| 項目 | 目標 |
| ---- | ---- |
| 月間稼働率 | 99%（約7時間/月のダウンタイム許容） |
| 計画メンテナンス | 月1回、最大2時間 |

### バックアップ

| 項目 | 方針 |
| ---- | ---- |
| データベース | 日次自動バックアップ（Supabase標準機能） |
| 保持期間 | 7日間 |
| リストア時間 | 4時間以内 |

### 障害復旧

| 項目 | 方針 |
| ---- | ---- |
| RTO（目標復旧時間） | 24時間 |
| RPO（目標復旧時点） | 24時間前のデータ |

## セキュリティ要件

### 認証・認可

| 項目 | 要件 |
| ---- | ---- |
| 認証方式 | AWS Cognito（メール/パスワード） |
| パスワードポリシー | 8文字以上、英数字混合 |
| セッション有効期間 | 7日間 |
| 多要素認証 | 将来対応（Phase 2） |

### データ保護

| 項目 | 要件 |
| ---- | ---- |
| 通信暗号化 | HTTPS（TLS 1.2以上） |
| データ暗号化 | Supabase標準（保存時暗号化） |
| 個人情報 | メールアドレスのみ保持 |

### アクセス制御

| 項目 | 要件 |
| ---- | ---- |
| Row Level Security | 全テーブルで有効 |
| APIアクセス | JWT認証必須 |
| CORS | 許可ドメインのみ |

### 脆弱性対策

| 脅威 | 対策 |
| ---- | ---- |
| SQLインジェクション | パラメータ化クエリ、Supabase RLS |
| XSS | React自動エスケープ、CSP設定 |
| CSRF | SameSite Cookie、トークン検証 |
| 不正ログイン | レート制限、アカウントロック |

## 拡張性要件

### スケーラビリティ

| 項目 | 方針 |
| ---- | ---- |
| フロントエンド | Vercel自動スケーリング |
| バックエンド | Fly.io自動スケーリング |
| データベース | Supabase有料プランへ移行可能 |

### 機能拡張性

| 項目 | 方針 |
| ---- | ---- |
| 新規アプリ追加 | モノレポ構成で容易に追加可能 |
| API拡張 | バージョニング（/api/v1/）で対応 |
| UIコンポーネント | @harborix/uiで共通化 |

## 保守性要件

### ログ

| 項目 | 要件 |
| ---- | ---- |
| アプリケーションログ | 構造化ログ（JSON形式） |
| アクセスログ | リクエスト/レスポンス記録 |
| エラーログ | スタックトレース含む |
| 保持期間 | 30日間 |

### 監視

| 項目 | 方針 |
| ---- | ---- |
| 死活監視 | Vercel/Fly.io標準機能 |
| エラー監視 | 将来対応（Sentry等） |
| パフォーマンス監視 | 将来対応 |

### デプロイ

| 項目 | 方針 |
| ---- | ---- |
| デプロイ方式 | Git push → 自動デプロイ |
| ロールバック | Git revert → 自動デプロイ |
| 環境 | 本番のみ（開発はローカル） |

## ユーザビリティ要件

### 対応環境

| 項目 | 対応範囲 |
| ---- | -------- |
| ブラウザ | Chrome、Safari、Firefox、Edge（最新2バージョン） |
| デバイス | PC、タブレット、スマートフォン |
| 画面幅 | 320px〜2560px |

### アクセシビリティ

| 項目 | 要件 |
| ---- | ---- |
| WCAG | 2.1 Level AA準拠を目標 |
| キーボード操作 | 全機能アクセス可能 |
| スクリーンリーダー | 主要機能対応 |
| カラーコントラスト | 4.5:1以上 |

### 多言語対応

| 項目 | 方針 |
| ---- | ---- |
| 対応言語 | 日本語のみ（初期リリース） |
| 国際化基盤 | 将来対応可能な設計 |

## 互換性要件

### API互換性

| 項目 | 方針 |
| ---- | ---- |
| 後方互換性 | メジャーバージョン内で維持 |
| 非推奨API | 3ヶ月の移行期間 |

### データ互換性

| 項目 | 方針 |
| ---- | ---- |
| エクスポート | JSON/CSV形式 |
| インポート | JSON/CSV形式 |

## 制約事項

### 技術的制約

| 項目 | 制約 |
| ---- | ---- |
| Supabase無料枠 | 500MB DB、1GB Storage |
| Vercel無料枠 | 100GB帯域/月 |
| Fly.io無料枠 | 3 shared-cpu VMs |

### 運用制約

| 項目 | 制約 |
| ---- | ---- |
| 運用体制 | 個人（1名） |
| サポート | なし（個人利用のみ） |
| SLA | なし |

## 変更履歴

- 2026-02-13: 初版作成
